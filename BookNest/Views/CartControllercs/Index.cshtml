@model IEnumerable<Cart>
<style>
    .compact-card {
        border-radius: 10px;
    }

    .compact-row {
        min-height: 90px; /* controls overall height */
    }

    .compact-img {
        height: 80px;
        width: auto;
        object-fit: cover;
        border-radius: 6px;
    }

    .compact-img-col {
        padding: 6px;
    }

    .compact-body {
        padding: 6px;
    }

        .compact-body h6 {
            font-size: 14px;
            font-weight: 600;
        }

        .compact-body p {
            font-size: 12px;
            color: #666;
        }

    .compact-qty button {
        padding: 2px 8px;
        font-size: 14px;
    }

    .qty-display {
        font-size: 14px;
        font-weight: 600;
    }
</style>
@foreach (var item in Model)
{
    <div class="card mb-2 shadow-sm compact-card">
        <div class="row g-0 align-items-center compact-row">

            <div class="col-2 compact-img-col">
                <img src="@item.ImageUrl" class="img-fluid compact-img" alt="@item.Title">
            </div>

            <div class="col-7">
                <div class="card-body compact-body">
                    <h6 class="card-title mb-1">@item.Title</h6>
                    <p class="card-text small mb-0">@item.Year</p>
                </div>
            </div>

            <div class="col-3 text-center">
                <div class="d-flex justify-content-center align-items-center compact-qty">
                    <button class="btn btn-outline-success minus btn-sm" data-id="@item.CartId">−</button>
                    <span class="mx-2 qty-display">@item.AvailableQuantity</span>
                    <button class="btn btn-outline-success plus btn-sm" data-id="@item.CartId">+</button>
                </div>
            </div>

        </div>
    </div>
    }
    @section Scripts 
    {
        <script>
                    $(document).ready(function () {
            $(".qty-display").each(function () {
                var qty = parseInt($(this).text());
                if (qty === 0) {
                    $(this).closest(".card").remove();
                }
            });
        });

            $(document).on("click", ".plus", function () {

            var cartId = $(this).data("id");
            var qtySpan = $(this).siblings(".qty-display");
            var currentQty = parseInt(qtySpan.text());

            $.ajax({
                url: '/CartControllercs/IncreaseQtyByOneInCart',
                type: 'POST',
                data: { cartId: cartId },
                success: function () {
                    qtySpan.text(currentQty + 1);
                }
            });
        });


        $(document).on("click", ".minus", function () {

            var cartId = $(this).data("id");
            var qtySpan = $(this).siblings(".qty-display");
            var currentQty = parseInt(qtySpan.text());

            if (currentQty <= 1) {
                // remove card when qty = 0
                $.ajax({
                    url: '/CartControllercs/DecreaseQtyByOneInCart',
                    type: 'POST',
                    data: { cartId: cartId },
                    success: function () {
                        qtySpan.closest(".card").remove(); // remove row
                    }
                });
            } else {
                $.ajax({
                    url: '/CartControllercs/DecreaseQtyByOneInCart',
                    type: 'POST',
                    data: { cartId: cartId },
                    success: function () {
                        qtySpan.text(currentQty - 1);
                    }
                });
            }
        });

    </script>
    }
